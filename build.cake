#tool nuget:?package=NUnit.ConsoleRunner&version=3.4.0
//////////////////////////////////////////////////////////////////////
// ARGUMENTS
//////////////////////////////////////////////////////////////////////

var target = Argument("target", "Default");
var configuration = Argument("configuration", "Release");

//////////////////////////////////////////////////////////////////////
// PREPARATION
//////////////////////////////////////////////////////////////////////

// Define directories.
var buildDir = Directory("./build");
var version = EnvironmentVariable("APPVEYOR_BUILD_VERSION") ?? Argument("version", "4.9.4");

//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Clean")
    .Does(() =>
{
    CleanDirectory(buildDir);
});

Task("Build-NuGet-Packages")
    .Does(() =>
    {
        var file = new System.IO.FileInfo("src\\Dependencies\\Package.nuspec");
        var path = file.Directory;
        var nuGetPackSettings = new NuGetPackSettings()
        {
			OutputDirectory = buildDir,
            Version = version,
			Properties = new Dictionary<string, string>()
			{{ "Configuration", configuration }}
        };
		NuGetPack(file.FullName, nuGetPackSettings);
});


//////////////////////////////////////////////////////////////////////
// TASK TARGETS
//////////////////////////////////////////////////////////////////////

Task("Default")
    .IsDependentOn("Clean")
	.IsDependentOn("Build-NuGet-Packages");

//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);